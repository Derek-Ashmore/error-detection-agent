# Error Detection Agent - Default Configuration
#
# This is the default configuration file for the Error Detection Agent.
# Copy this file and customize it for your environment.
#
# Environment variables can override these settings:
# - AZURE_WORKSPACE_ID, AZURE_TENANT_ID, AZURE_CLIENT_ID, AZURE_CLIENT_SECRET
# - GITHUB_TOKEN, GITHUB_REPOSITORY
# - ENVIRONMENT, LOG_LEVEL

# Azure Monitor Configuration
azureMonitor:
  # Azure Log Analytics workspace ID
  workspaceId: "your-workspace-id-here"

  # Azure Active Directory tenant ID
  tenantId: "00000000-0000-0000-0000-000000000000"

  # Service principal client ID
  clientId: "00000000-0000-0000-0000-000000000000"

  # Service principal client secret (use environment variable in production!)
  clientSecret: "your-client-secret-here"

  # Optional: Azure subscription ID
  # subscriptionId: "00000000-0000-0000-0000-000000000000"

  # Optional: Resource group name
  # resourceGroup: "your-resource-group"

  # Optional: Custom API endpoint (defaults to Azure public cloud)
  # endpoint: "https://api.loganalytics.io"

# Log Fetching Configuration
logFetching:
  # Query interval in minutes (how often to fetch logs)
  queryIntervalMinutes: 5

  # Batch size for log retrieval (max records per query)
  batchSize: 1000

  # Lookback period in minutes for initial query
  lookbackMinutes: 60

  # Maximum number of retries for failed queries
  maxRetries: 3

  # Retry delay in milliseconds
  retryDelayMs: 5000

  # Timeout for log queries in milliseconds
  queryTimeoutMs: 30000

  # Optional: KQL query template
  # queryTemplate: |
  #   AppTraces
  #   | where TimeGenerated > ago(5m)
  #   | where SeverityLevel in (2, 3)
  #   | project TimeGenerated, Message, SeverityLevel, Properties

# Failure Detection Configuration
failureDetection:
  # Failure detection patterns
  patterns:
    # Critical errors
    - name: "OutOfMemoryError"
      pattern: "OutOfMemoryError|OOM|out of memory"
      type: "critical"
      priority: 10
      description: "Detects out of memory errors"
      enabled: true

    - name: "NullPointerException"
      pattern: "NullPointerException|NPE|null reference"
      type: "error"
      priority: 8
      description: "Detects null pointer exceptions"
      enabled: true

    - name: "DatabaseConnectionFailure"
      pattern: "database connection (failed|error|timeout)|connection pool exhausted"
      type: "critical"
      priority: 9
      description: "Detects database connection failures"
      enabled: true

    - name: "APITimeout"
      pattern: "timeout|request timeout|gateway timeout|504"
      type: "error"
      priority: 7
      description: "Detects API timeout errors"
      enabled: true

    - name: "AuthenticationFailure"
      pattern: "authentication (failed|error)|unauthorized|401|403"
      type: "error"
      priority: 8
      description: "Detects authentication failures"
      enabled: true

    # Warnings
    - name: "DeprecationWarning"
      pattern: "deprecated|deprecation warning"
      type: "warning"
      priority: 3
      description: "Detects deprecation warnings"
      enabled: true

    - name: "PerformanceDegradation"
      pattern: "slow query|performance degradation|high latency"
      type: "warning"
      priority: 5
      description: "Detects performance issues"
      enabled: true

  # Minimum confidence threshold for pattern matching (0-1)
  confidenceThreshold: 0.75

  # Enable ML-based pattern detection
  enableMlDetection: false

  # Custom error keywords to detect
  errorKeywords:
    - "error"
    - "exception"
    - "failed"
    - "failure"
    - "fatal"
    - "critical"

  # Log levels to consider as failures
  failureLogLevels:
    - "Error"
    - "Critical"
    - "Fatal"

# GitHub Integration Configuration
github:
  # GitHub repository in format 'owner/repo'
  repository: "your-org/your-repo"

  # GitHub personal access token (use environment variable in production!)
  token: "ghp_your_token_here"

  # Optional: GitHub API endpoint (for GitHub Enterprise)
  # apiEndpoint: "https://api.github.com"

  # Default labels to apply to created issues
  defaultLabels:
    - "bug"
    - "automated"
    - "azure-monitor"

  # Optional: Users/teams to assign issues to
  # assignees:
  #   - "username1"
  #   - "username2"

  # Enable auto-assignment of issues
  autoAssign: false

  # Optional: Issue title template
  # issueTitleTemplate: "[Azure Monitor] {{errorType}}: {{summary}}"

  # Optional: Issue body template
  # issueBodyTemplate: |
  #   ## Error Details
  #   **Type:** {{errorType}}
  #   **Severity:** {{severity}}
  #   **First Seen:** {{firstSeen}}
  #   **Occurrences:** {{count}}
  #
  #   ## Error Message
  #   ```
  #   {{errorMessage}}
  #   ```

# Duplicate Detection Configuration
duplicateDetection:
  # Enable duplicate detection
  enabled: true

  # Similarity threshold (0-1, where 1 is exact match)
  similarityThreshold: 0.85

  # Time window in hours to check for duplicates
  timeWindowHours: 24

  # Algorithm to use for similarity comparison
  # Options: levenshtein, jaccard, cosine
  algorithm: "jaccard"

  # Fields to compare for similarity
  compareFields:
    - "errorMessage"
    - "stackTrace"
    - "errorType"

  # Enable fuzzy matching
  enableFuzzyMatching: true

# Scheduler Configuration
scheduler:
  # Enable automatic scheduling
  enabled: true

  # Cron expression for scheduling
  # Examples:
  # - "*/5 * * * *"  : Every 5 minutes
  # - "0 * * * *"    : Every hour
  # - "0 0 * * *"    : Every day at midnight
  cronExpression: "*/5 * * * *"

  # Timezone for cron scheduling
  timezone: "UTC"

  # Run immediately on startup
  runOnStartup: true

  # Maximum concurrent executions
  maxConcurrentExecutions: 1

  # Execution timeout in milliseconds
  executionTimeoutMs: 300000

# Optional: Notification Configuration
# notification:
#   enabled: false
#   channels:
#     - "email"
#   severityLevels:
#     - "critical"
#     - "error"
#
#   # Email configuration
#   email:
#     smtpHost: "smtp.example.com"
#     smtpPort: 587
#     from: "alerts@example.com"
#     to:
#       - "team@example.com"
#     username: "smtp-user"
#     password: "smtp-password"
#
#   # Slack configuration
#   slack:
#     webhookUrl: "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
#     channel: "#alerts"
#     username: "Error Detection Bot"
#
#   # Teams configuration
#   teams:
#     webhookUrl: "https://outlook.office.com/webhook/YOUR/WEBHOOK/URL"

# Logging Configuration
logging:
  # Log level: debug, info, warn, error
  level: "info"

  # Log format: json, text
  format: "json"

  # Enable console logging
  enableConsole: true

  # Enable file logging
  enableFile: false

  # Optional: Log file path
  # filePath: "./logs/app.log"

  # Optional: Maximum log file size in bytes (10MB)
  # maxFileSize: 10485760

  # Optional: Maximum number of log files to retain
  # maxFiles: 5

# Application Environment
# Options: development, staging, production
environment: "development"

# Optional: Application version
# version: "1.0.0"
